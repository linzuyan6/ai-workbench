<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>小林的 AI 工作台</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    -webkit-tap-highlight-color: transparent;
  }
  html, body {
    overflow-x: hidden;
    touch-action: manipulation;
    -webkit-overflow-scrolling: touch;
  }
  body {
    background: linear-gradient(135deg, #d4e8ff 0%, #f8f9fa 50%, #fad7e0 100%);
    color: #333;
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
  }
  .title {
    font-size: 36px;
    font-weight: 600;
    margin-bottom: 40px;
    text-align: center;
    color: #2c3e50;
  }

  .model-section {
    margin-bottom: 40px;
  }
  .section-title {
    font-size: 16px;
    color: #007aff;
    font-weight: 600;
    margin-bottom: 20px;
  }
  .model-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: flex-start;
  }
  .model-card {
    flex: 1;
    min-width: 180px;
    padding: 30px 20px;
    border-radius: 16px;
    border: 1px solid #e0e6ed;
    background: #fff;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    -webkit-touch-callout: none;
  }
  .model-card:hover {
    border-color: #007aff;
    box-shadow: 0 10px 25px rgba(0,122,255,0.16);
    transform: translateY(-5px);
  }
  .model-card.active {
    border-color: #007aff;
    background: #f0f7ff;
    box-shadow: 0 10px 25px rgba(0,122,255,0.16);
    transform: translateY(-5px);
  }
  .gpt-icon {
    width: 70px;
    height: 70px;
    margin: 0 auto 16px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }
  .gemini-icon {
    width: 55px;
    height: 55px;
    margin: 0 auto 16px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }
  .model-name {
    font-size: 18px;
    font-weight: 600;
    color: #2c3e50;
  }
  .model-card .tooltip,
  .free-btn .tooltip {
    visibility: hidden;
    width: 220px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 8px;
    padding: 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 14px;
    line-height: 1.5;
  }
  .model-card .tooltip::after,
  .free-btn .tooltip::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
  }
  .model-card:hover .tooltip,
  .free-btn:hover .tooltip {
    visibility: visible;
    opacity: 1;
  }

  .free-model-row {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .free-btn {
    position: relative;
    padding: 12px 24px;
    min-width: 120px;
    border-radius: 20px;
    border: 1px solid #e0e6ed;
    background: #fff;
    color: #555;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    -webkit-appearance: none;
  }
  .free-btn:hover {
    border-color: #007aff;
    color: #007aff;
    background: #f5f9ff;
  }

  .chat-area {
    margin-top: 50px;
    background: #fff;
    border-radius: 16px;
    border: 1px solid #e0e6ed;
    overflow: hidden;
  }
  .message-box {
    padding: 0 16px;
    white-space: pre-wrap;
    line-height: 1.8;
    font-size: 15px;
    color: #333;
    overflow-y: auto;
    max-height: 450px;
  }
  .message {
    margin: 0;
    padding: 16px 0 8px 0;
    border-bottom: none;
  }
  .message:first-child {
    padding-top: 0;
  }
  .user-msg {
    color: #007aff;
    font-weight: 600;
    margin-bottom: 4px;
    font-size: 16px;
  }
  .ai-msg {
    color: #333;
    font-size: 16px;
    font-weight: 400;
  }

  .input-row {
    display: flex;
    border-top: 1px solid #e0e6ed;
    align-items: center;
  }
  .attach-btn {
    font-size: 18px;
    padding: 0 12px;
    background: none;
    border: none;
    cursor: pointer;
    color: #666;
    -webkit-appearance: none;
  }
  .attach-btn:hover {
    color: #007aff;
  }
  #fileInput {
    display: none;
  }
  .attachment-info {
    padding: 0 10px;
    font-size: 12px;
    color: #007aff;
  }
  input {
    flex: 1;
    padding: 18px 12px;
    border: none;
    font-size: 15px;
    outline: none;
    -webkit-appearance: none;
  }
  button {
    padding: 18px 28px;
    background: #007aff;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.2s;
    -webkit-appearance: none;
  }
  button:hover {
    background: #0056b3;
  }
  button.clear-btn {
    background: #ff6b6b;
  }
  button.clear-btn:hover {
    background: #e55353;
  }

  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }
  .modal {
    background: white;
    width: 90%;
    max-width: 700px;
    padding: 40px;
    border-radius: 20px;
    max-height: 80vh;
    overflow-y: auto;
  }
  .modal h2 {
    margin-bottom: 24px;
    font-size: 22px;
    color: #2c3e50;
  }
  .qa-item {
    margin-bottom: 20px;
  }
  .q {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
  }
  .a {
    font-size: 15px;
    color: #555;
    line-height: 1.6;
  }
  .close-btn {
    margin-top: 30px;
    background: #f0f0f0;
    color: #333;
  }
  .close-btn:hover {
    background: #e0e0e0;
  }

  .footer {
    margin-top: 60px;
    font-size: 13px;
    color: #888;
    text-align: center;
  }
  .link {
    color: #007aff;
    cursor: pointer;
    text-decoration: underline;
  }
</style>
</head>

<body>

<div class="title">小林的 AI 工作台</div>

<div class="model-section">
  <div class="section-title">计费模型</div>
  <div class="model-row">
    <div class="model-card" data-model="gpt-3.5-turbo">
      <div class="gpt-icon" style="background-image: url('gpt3.png')"></div>
      <div class="model-name">GPT-3.5</div>
      <div class="tooltip">英文写作、海外文献梳理、基础逻辑验证</div>
    </div>
    <div class="model-card" data-model="gpt-4">
      <div class="gpt-icon" style="background-image: url('gpt4.png')"></div>
      <div class="model-name">GPT-4</div>
      <div class="tooltip">学术论文、深度推理、竞赛方案、专业报告</div>
    </div>
    <div class="model-card" data-model="gemini-2.0-flash">
      <svg class="gemini-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="geminiGrad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#4285F4;stop-opacity=1" />
            <stop offset="33%" style="stop-color:#34A853;stop-opacity=1" />
            <stop offset="66%" style="stop-color:#FBBC05;stop-opacity=1" />
            <stop offset="100%" style="stop-color:#EA4335;stop-opacity=1" />
          </linearGradient>
        </defs>
        <path fill="url(#geminiGrad)" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-12c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
      </svg>
      <div class="model-name">Gemini 2.0 Flash</div>
      <div class="tooltip">极速响应、超长上下文、多模态、性价比之王</div>
    </div>
  </div>
</div>

<div class="model-section">
  <div class="section-title">免费模型</div>
  <div class="free-model-row">
    <button class="free-btn" data-url="https://www.doubao.com">
      豆包
      <div class="tooltip">课堂笔记、日常问答、文案整理、快速构思</div>
    </button>
    <button class="free-btn" data-url="https://www.deepseek.com">
      DeepSeek
      <div class="tooltip">代码编写、数据处理、算法思路、技术实现</div>
    </button>
    <button class="free-btn" data-url="https://tongyi.aliyun.com">
      千问
      <div class="tooltip">知识总结、资料整理、作业撰写、通用报告</div>
    </button>
    <button class="free-btn" data-url="https://kimi.moonshot.cn">
      Kimi
      <div class="tooltip">文献精读、长文阅读、PDF 解析、材料归纳</div>
    </button>
  </div>
</div>

<div class="chat-area">
  <div class="message-box" id="messageBox">
    <div class="message">
      <div class="user-msg">系统提示</div>
      <div class="ai-msg">
        <div>请先选择模型；对话历史会自动保留，切换模型不影响原有历史记录。</div>
        <div style="margin-top:6px;">支持发送文本、<strong>TXT / PDF / Word</strong> 文档；左下角 <strong>📎 回形针可上传文件</strong>，<strong>仅 Gemini 2.0 Flash 支持图片识别</strong>。</div>
        <div style="margin-top:6px;">温馨提醒：上下文对话会持续累积，不清空将携带全部历史记录，消耗更多额度；<strong>GPT-4 费用较高，请谨慎使用</strong>。</div>
      </div>
    </div>
  </div>

  <div class="input-row">
    <button class="attach-btn" onclick="document.getElementById('fileInput').click()">📎</button>
    <input type="file" id="fileInput" accept="*">
    <span class="attachment-info" id="attachmentInfo"></span>
    <input id="userInput" placeholder="请输入你的问题..." type="text">
    <button onclick="sendMessage()">发送</button>
    <button class="clear-btn" onclick="clearHistory()">清除</button>
  </div>
</div>

<div class="footer">
  <div>仅供学习使用 · 小林制作</div>
  <div class="link" onclick="showQA()">使用说明 · 快问快答</div>
</div>

<div id="firstModal" class="modal-overlay">
  <div class="modal">
    <h2>小林的 AI 工作台 · 快问快答</h2>
    <div class="qa-item">
      <div class="q">1. 为什么使用这个网站？</div>
      <div class="a">一站式聚合国内外主流 AI 模型，界面简洁，专为学生学习、作业、竞赛、论文场景优化。</div>
    </div>
    <div class="qa-item">
      <div class="q">2. 什么是计费模型？</div>
      <div class="a">上方 GPT-3.5 / GPT-4 / Gemini 2.0 Flash 为计费模型，调用付费接口，会消耗额度。下方为免费跳转模型。</div>
    </div>
    <div class="qa-item">
      <div class="q">3. 和官方 / 镜像站比优势？</div>
      <div class="a">无需海外账号、无需复杂支付，稳定、干净、性价比更高，适合学生使用。</div>
    </div>
    <div class="qa-item">
      <div class="q">4. 使用建议</div>
      <div class="a">日常任务用国内免费模型；论文、竞赛、英文等高阶任务使用计费模型。</div>
    </div>
    <button class="close-btn" onclick="closeFirstModal()">我已阅读，下一步</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.0.379/build/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>

<script>
const API_URL = "https://oa.api2d.net/v1/chat/completions";
const FORWARD_KEY = "fk236821-pGPMtjGgLLbnIXLPtct56cCUFDGvWUK6";

let currentModel = null;
let messageBox = document.getElementById("messageBox");
let conversationHistory = [];
let selectedFile = null;

document.querySelectorAll('.model-card').forEach(card => {
  card.addEventListener('click', () => {
    document.querySelectorAll('.model-card').forEach(c => c.classList.remove('active'));
    card.classList.add('active');
    currentModel = card.dataset.model;
  });
});

document.querySelectorAll('.free-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    window.open(btn.dataset.url, '_blank');
  });
});

document.getElementById('fileInput').addEventListener('change', (e) => {
  selectedFile = e.target.files[0];
  if (selectedFile) {
    document.getElementById('attachmentInfo').textContent = `已附加：${selectedFile.name}`;
  } else {
    document.getElementById('attachmentInfo').textContent = '';
  }
});

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      const base64Data = reader.result.split(',')[1];
      resolve(base64Data);
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

async function extractTextFromFile(file) {
  const ext = file.name.split('.').pop().toLowerCase();
  if (ext === 'txt') {
    return new Promise((resolve, reject) => {
      const r = new FileReader();
      r.onload = () => resolve(r.result);
      r.onerror = reject;
      r.readAsText(file);
    });
  }
  if (ext === 'pdf') {
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    let text = "";
    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      text += content.items.map(it => it.str).join(" ") + "\n";
    }
    return text;
  }
  if (ext === 'docx') {
    const arrayBuffer = await file.arrayBuffer();
    const result = await mammoth.extractRawText({ arrayBuffer });
    return result.value;
  }
  return "[不支持的文件类型]";
}

async function sendMessage() {
  let q = document.getElementById("userInput").value.trim();
  if (!q && !selectedFile) {
    addMessage("系统提示", "请输入问题或选择文件");
    return;
  }
  if (!currentModel) {
    addMessage("系统提示", "请先选择模型");
    return;
  }

  document.getElementById("userInput").value = "";
  let userMessageContent = q;

  if (selectedFile && selectedFile.type.startsWith('image/')) {
    try {
      const base64Image = await fileToBase64(selectedFile);
      userMessageContent = [
        { type: "text", text: q },
        {
          type: "image_url",
          image_url: {
            url: `data:${selectedFile.type};base64,${base64Image}`
          }
        }
      ];
    } catch (err) {
      addMessage("系统提示", "图片处理失败：" + err.message);
      return;
    }
  } else if (selectedFile) {
    try {
      const fileText = await extractTextFromFile(selectedFile);
      userMessageContent = `${q}\n\n--- 上传文件：${selectedFile.name} ---\n${fileText}`;
    } catch (err) {
      userMessageContent = `${q}\n[附件：${selectedFile.name}（解析失败）]`;
    }
  }

  conversationHistory.push({
    role: "user",
    content: userMessageContent
  });

  addMessage("你", selectedFile ? `${q}\n[附件：${selectedFile.name}]` : q);
  addMessage(`【${currentModel.toUpperCase()}】`, "正在思考中...", true);

  try {
    let res = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + FORWARD_KEY
      },
      body: JSON.stringify({
        model: currentModel,
        messages: conversationHistory
      })
    });
    let data = await res.json();
    let reply = data.choices?.[0]?.message?.content || "请求失败，请检查网络或Key";

    const messages = messageBox.querySelectorAll('.message');
    const lastMessage = messages[messages.length - 1];
    lastMessage.querySelector('.ai-msg').textContent = reply;
    conversationHistory.push({ role: "assistant", content: reply });

  } catch (e) {
    const messages = messageBox.querySelectorAll('.message');
    const lastMessage = messages[messages.length - 1];
    lastMessage.querySelector('.ai-msg').textContent = "请求出错：" + e.toString();
  }

  selectedFile = null;
  document.getElementById('attachmentInfo').textContent = '';
  document.getElementById('fileInput').value = '';
}

function addMessage(sender, content, isPending = false) {
  const messageDiv = document.createElement('div');
  messageDiv.className = 'message';
  
  const senderDiv = document.createElement('div');
  senderDiv.className = 'user-msg';
  senderDiv.textContent = sender;
  
  const contentDiv = document.createElement('div');
  contentDiv.className = 'ai-msg';
  contentDiv.textContent = content;
  
  messageDiv.appendChild(senderDiv);
  messageDiv.appendChild(contentDiv);
  messageBox.appendChild(messageDiv);
  
  messageBox.scrollTop = messageBox.scrollHeight;
}

function clearHistory() {
  conversationHistory = [];
  messageBox.innerHTML = `
    <div class="message">
      <div class="user-msg">系统提示</div>
      <div class="ai-msg">
        <div>请先选择模型；对话历史会自动保留，切换模型不影响原有历史记录。</div>
        <div style="margin-top:6px;">支持发送文本、<strong>TXT / PDF / Word</strong> 文档；左下角 <strong>📎 回形针可上传文件</strong>，<strong>仅 Gemini 2.0 Flash 支持图片识别</strong>。</div>
        <div style="margin-top:6px;">温馨提醒：上下文对话会持续累积，不清空将携带全部历史记录，消耗更多额度；<strong>GPT-4 费用较高，请谨慎使用</strong>。</div>
      </div>
    </div>
  `;
}

function showQA() {
  document.getElementById("firstModal").style.display = "flex";
}

function closeFirstModal() {
  document.getElementById("firstModal").style.display = "none";
  setTimeout(showPassword, 300);
}

function showPassword() {
  let ans = prompt("请输入答案：我最喜欢的歌手？");
  if (ans && ans.trim() === "陶喆") {
  } else {
    alert("答案不正确，无法使用");
    window.close();
  }
}
</script>
</body>
</html>